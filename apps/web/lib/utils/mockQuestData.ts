import { IGeneratedQuestData } from '@/components/quests/GeneratedQuestDisplay';

// Массивы с возможными значениями для генерации случайных данных
const questTitles = [
  'Тайна заброшенного маяка',
  'Поиск потерянного артефакта',
  'Загадка старого парка',
  'Секрет древнего манускрипта',
  'Путешествие в затерянную деревню',
  'Расследование в старинном особняке',
  'Легенда о подземном городе',
  'Приключение в заколдованном лесу',
  'Миссия в параллельном мире',
  'Загадка исчезнувшей экспедиции'
];

const difficulties = ['Легкая', 'Средняя', 'Сложная', 'Эксперт'] as const;

const estimatedTimes = [
  '~15 минут',
  '~30 минут',
  '~45 минут',
  '~1 час',
  '~1.5 часа',
  '~2 часа'
];

const questTags = [
  'приключение', 'загадка', 'головоломка', 'исследование', 
  'мистика', 'история', 'наука', 'природа', 'город', 
  'технологии', 'искусство', 'культура', 'спорт', 'еда'
];

const questImages = [
  'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=1000',
  'https://images.unsplash.com/photo-1524729429516-485db0307e59?q=80&w=1000',
  'https://images.unsplash.com/photo-1503221043305-f7498f8b7888?q=80&w=1000',
  'https://images.unsplash.com/photo-1445452916036-9022dfd33aa8?q=80&w=1000',
  'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1000'
];

// Функция для получения случайного элемента из массива
function getRandomItem<T>(array: readonly T[] | T[]): T {
  return array[Math.floor(Math.random() * array.length)];
}

// Функция для получения нескольких случайных элементов из массива без повторений
function getRandomItems<T>(array: readonly T[] | T[], count: number): T[] {
  const shuffled = [...array].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}

// Функция для генерации случайной истории квеста
function generateRandomStory(): string {
  const storyIntros = [
    'Давным-давно в этих местах произошло нечто загадочное...',
    'Легенда гласит, что где-то здесь спрятан древний артефакт...',
    'Местные жители рассказывают странную историю...',
    'Недавно археологи обнаружили удивительную находку...',
    'В старых архивах была найдена таинственная запись...'
  ];
  
  const storyMiddles = [
    'Никто не решался проверить эту историю, пока не появился ты.',
    'Многие пытались разгадать эту тайну, но никому не удалось.',
    'Эта загадка оставалась нерешенной на протяжении многих лет.',
    'Ходят слухи, что те, кто пытался узнать правду, бесследно исчезали.',
    'Местные власти отрицают существование этой истории, но доказательства говорят об обратном.'
  ];
  
  const storyEndings = [
    'Теперь тебе предстоит раскрыть эту тайну и найти истину.',
    'Сможешь ли ты разгадать эту загадку и вернуться с ответами?',
    'Твоя задача — исследовать это место и документировать свои находки.',
    'Будь осторожен, ведь неизвестно, что ждет тебя в конце этого приключения.',
    'Это приключение может изменить твое представление о мире вокруг.'
  ];
  
  return `${getRandomItem(storyIntros)}\n\n${getRandomItem(storyMiddles)}\n\n${getRandomItem(storyEndings)}`;
}

// Функция для генерации случайных шагов квеста
function generateRandomSteps(count: number = 5) {
  const stepTitles = [
    'Найти ключевую подсказку',
    'Исследовать таинственное место',
    'Поговорить с местным жителем',
    'Расшифровать древние символы',
    'Найти спрятанный предмет',
    'Решить головоломку',
    'Сфотографировать необычное явление',
    'Собрать необходимые материалы',
    'Выполнить ритуал',
    'Найти секретный проход'
  ];
  
  const stepDescriptions = [
    'Внимательно осмотри окружающую территорию. Обрати внимание на необычные детали и предметы, которые кажутся не на своем месте.',
    'Поговори с местными жителями. Они могут знать важные детали или легенды, связанные с этим местом.',
    'Исследуй указанную локацию. Ищи скрытые символы, надписи или предметы, которые могут дать подсказку.',
    'Сделай фотографии необычных объектов или явлений, которые ты заметишь во время выполнения квеста.',
    'Собери определенные предметы, которые могут пригодиться для решения загадки или выполнения ритуала.',
    'Расшифруй найденные символы или текст. Используй подсказки из окружающей среды или предыдущих шагов.',
    'Реши головоломку, используя найденные предметы или полученную информацию.',
    'Найди спрятанный предмет, следуя указаниям или используя логику и наблюдательность.',
    'Выполни определенные действия в указанном порядке, чтобы активировать механизм или раскрыть тайну.',
    'Документируй свои находки и наблюдения. Это поможет тебе собрать все части головоломки вместе.'
  ];
  
  const steps = [];
  const usedTitles = new Set();
  
  for (let i = 0; i < count; i++) {
    let title;
    // Убедимся, что заголовки не повторяются
    do {
      title = getRandomItem(stepTitles);
    } while (usedTitles.has(title));
    
    usedTitles.add(title);
    
    steps.push({
      title,
      description: getRandomItem(stepDescriptions)
    });
  }
  
  return steps;
}

// Основная функция для генерации случайных данных квеста
export function generateMockQuestData(): IGeneratedQuestData {
  const tagCount = Math.floor(Math.random() * 3) + 2; // от 2 до 4 тегов
  const stepCount = Math.floor(Math.random() * 3) + 3; // от 3 до 5 шагов
  
  return {
    title: getRandomItem(questTitles),
    imageUrl: getRandomItem(questImages),
    difficulty: getRandomItem(difficulties),
    estimatedTime: getRandomItem(estimatedTimes),
    tags: getRandomItems(questTags, tagCount),
    story: generateRandomStory(),
    steps: generateRandomSteps(stepCount)
  };
}
