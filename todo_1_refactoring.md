Проведи детальный анализ кода проекта QuestAI для рефакторинга, упрощения и улучшения архитектуры. Проект представляет собой монорепозиторий с Next.js фронтендом и NestJS бэкендом для создания квестов с помощью ИИ.

### СТРУКТУРА АНАЛИЗА:

## 1. FRONTEND (Next.js + React) - apps/web/

### Области анализа:
- **Компоненты React**: 
  - Разделение на презентационные и контейнерные компоненты
  - Выделение переиспользуемых UI элементов в packages/ui
  - Оптимизация состояния и пропсов
  - Применение паттернов композиции вместо наследования

- **Страницы и роутинг**:
  - Структура app/ директории (App Router)
  - Оптимизация SSR/SSG
  - Код-сплиттинг и ленивая загрузка

- **Хуки и утилиты**:
  - Кастомные хуки для бизнес-логики
  - Функции-хелперы в lib/
  - Управление состоянием

- **Стили и UI**:
  - Использование TailwindCSS
  - Shadcn UI компоненты
  - Консистентность дизайн-системы

### Критерии рефакторинга:
1. Принцип единственной ответственности (SRP)
2. DRY - устранение дублирования кода
3. Композиция компонентов
4. Типизация TypeScript
5. Производительность и оптимизация
6. Доступность (a11y)

## 2. BACKEND (NestJS) - apps/api/

### Области анализа:
- **Модули и контроллеры**:
  - Архитектура модулей
  - Разделение обязанностей контроллеров
  - Валидация данных (DTO)

- **Сервисы и провайдеры**:
  - Бизнес-логика в сервисах
  - Внедрение зависимостей
  - Работа с базой данных

- **Middleware и Guard'ы**:
  - Аутентификация и авторизация
  - Обработка ошибок
  - Логирование

- **API дизайн**:
  - RESTful принципы
  - Структура ответов
  - Обработка ошибок

### Критерии рефакторинга:
1. SOLID принципы
2. Слоистая архитектура
3. Обработка исключений
4. Валидация и безопасность
5. Масштабируемость
6. Документация API

## 3. ОБЩИЕ КОМПОНЕНТЫ - packages/

### Области анализа:
- **UI библиотека**:
  - Переиспользуемые компоненты
  - Типизация пропсов
  - Стилизация и темизация

- **Общие утилиты**:
  - Хелперы и константы
  - Типы TypeScript
  - Конфигурации

## 4. ИНТЕГРАЦИИ И СЕРВИСЫ

### Анализ интеграций:
- Supabase (БД + Auth)
- OpenAI API
- CloudPayments
- Обработка ошибок внешних сервисов

## ЗАДАЧИ ДЛЯ РЕФАКТОРИНГА:

### Архитектурные улучшения:
1. **Выделение доменов**: Разбить код на доменные области (auth, quests, payments, users)
2. **Абстрактные интерфейсы**: Создать абстракции для внешних сервисов
3. **Паттерны проектирования**: Применить Repository, Factory, Observer там, где уместно
4. **Ошибки и логирование**: Централизовать обработку ошибок

### Компонентный рефакторинг:
1. **Атомарные компоненты**: Разбить крупные компоненты на мелкие, переиспользуемые части
2. **Кастомные хуки**: Выделить логику в переиспользуемые хуки
3. **Контекст и провайдеры**: Оптимизировать управление состоянием
4. **Мемоизация**: Применить React.memo, useMemo, useCallback где нужно

### Производительность:
1. **Код-сплиттинг**: Разделить бандлы
2. **Кеширование**: Оптимизировать запросы к API
3. **Оптимизация рендеринга**: Минимизировать ре-рендеры
4. **Lazy loading**: Ленивая загрузка компонентов и страниц

### Качество кода:
1. **TypeScript**: Улучшить типизацию
2. **Тестирование**: Выделить тестируемые единицы
3. **Линтинг**: Применить правила ESLint
4. **Документация**: JSDoc комментарии

## ОЖИДАЕМЫЙ РЕЗУЛЬТАТ:

Предоставь детальный план рефакторинга с:
1. Конкретными примерами проблемных участков кода
2. Предложениями по улучшению с примерами
3. Приоритизацией задач по важности
4. Архитектурными диаграммами "до" и "после"
5. Чек-листом для проверки качества после рефакторинга

Фокусируйся на создании модульной, масштабируемой и поддерживаемой архитектуры.